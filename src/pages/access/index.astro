---
import BaseLayout from "../../layouts/BaseLayout.astro";

// Pages env var (як у Cloudflare UI)
const SITE_KEY = (import.meta.env.PUBLIC_TURNSTILE_SITE_KEY || "").trim();
---

<BaseLayout title="VDR — Request access">
  <Fragment slot="head">
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
  </Fragment>

  <section class="hero">
    <h1>Request access</h1>
    <p>Доступ надається за запитом. Всі дії логуються. Документи мають версійність.</p>

    <section class="form-card">
      {!SITE_KEY ? (
        <p style="color:#b00020;font-weight:700;">
          ⚠️ <strong>PUBLIC_TURNSTILE_SITE_KEY</strong> не заданий у Pages env vars (або потрібен redeploy).
        </p>
      ) : (
        <form method="POST" action="/api/request-access">
          <label for="email">Email</label>
          <input id="email" name="email" type="email" required placeholder="name@company.org" />

          <label for="purpose">Purpose</label>
          <input id="purpose" name="purpose" type="text" required placeholder="Donor due diligence / partnership / procurement..." />

          <div style="margin:14px 0;">
            <div class="cf-turnstile" data-sitekey={SITE_KEY}></div>
            <p class="meta" style="margin-top:10px;">Підтвердіть, що ви не бот (Turnstile).</p>
          </div>

          <div class="btns">
            <button class="btn primary" type="submit">Submit request</button>
            <a class="btn" href="/">Back</a>
          </div>
        </form>
      )}
    </section>
  </section>
</BaseLayout>
