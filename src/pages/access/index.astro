---
import BaseLayout from "../../layouts/BaseLayout.astro";

const RAW_SITE_KEY = import.meta.env.PUBLIC_TURNSTILE_SITE_KEY ?? "";
const SITE_KEY = RAW_SITE_KEY.trim().replace(/^"+|"+$/g, "");
---

<BaseLayout title="VDR — Request access">
  <Fragment slot="head">
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
  </Fragment>

  <section class="hero">
    <h1>Request access</h1>
    <p>Доступ надається за запитом. Всі дії логуються. Документи мають версійність.</p>

    <section class="form-card">
      {!SITE_KEY ? (
        <p style="color:#b00020;font-weight:600;">
          ⚠️ PUBLIC_TURNSTILE_SITE_KEY не заданий або порожній у Pages env vars.
        </p>
      ) : (
        <form method="POST" action="/api/request-access">
          <label for="email">Email</label>
          <input id="email" name="email" type="email" required placeholder="name@company.org" />

          <label for="purpose">Purpose</label>
          <input id="purpose" name="purpose" type="text" required placeholder="Donor due diligence / partnership / procurement..." />

          <div style="margin:14px 0;">
            <div class="cf-turnstile" data-sitekey={SITE_KEY}></div>
            <p class="meta" style="margin-top:10px;">Підтвердіть, що ви не бот (Turnstile).</p>
          </div>

          <div class="btns">
            <button class="btn primary" type="submit">Submit request</button>
            <a class="btn" href="/">Back</a>
          </div>
        </form>
      )}
    </section>
  </section>
</BaseLayout>
